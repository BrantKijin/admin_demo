<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default-layout}">
<head>
    <title>XP보이스-상담신청</title>
</head>

<body layout:fragment="content">

<!-- 컨텐츠 기본 영역 -->
<div id="warpper">

    <div class="sub-box bg02">
        <div class="sub-box mask">
            <div class="sub-box_tit">
                <h3>
                    상담신청
                </h3>
                <span>서비스 신청 및 도입 가능 여부에 대한 상담을 도와드리겠습니다.</span>
            </div>
        </div>
    </div>
    <!-- 메인 내용 컨텐츠 -->

    <div class="cont">
        <div class="cont_sec">
            <div class="consult_box slide">
                <form th:action="@{/main/voice-request}" th:method="post" id="dataForm">
                    <div class="consult_input ">
                        <ul>
                            <li>
                                <input type="text" placeholder="단지명(건물명)을 입력해주세요." name="aptName">
                                <label><span>단지명(건물명)<b class="essential_type"></b></span></label>
                            </li>
                            <li>
                                <input type="text" placeholder="세대수를 입력해주세요." id="householdNum" name="householdNum" oninput="formatInput(this)">
                                <label><span>세대수</span></label>
                            </li>
                            <li>
                                <input type="tel" placeholder="연락처를 입력해주세요. (-없이)" name="contact" onkeyup="inputPhoneNumber(event)" >
                                <label><span>연락처<b class="essential_type"></b></span></label>
                            </li>
                            <li>
                                <input type="email" placeholder="이메일을 입력해주세요" name="email">
                                <label><span>이메일</span></label>
                            </li>
                            <li>
                                <div class="selectbox mg0">
                                    <select id="requestStatus" name="requestStatus">
                                        <option value="XP보이스_신규계약">1. 신규계약</option>
                                        <option value="XP보이스_상담진행">2. 상담</option>
                                        <option value="XP보이스_현장답사">3. 현장답사</option>
                                    </select>
                                    <label for="data"><span>신청사항</span></label>
                                </div>
                            </li>
                        </ul>
                    </div>


                    <div class="tit mgB16">
                        <h2 class="fs16 t_left">
                            개인정보 수집 및 이용에 대한 안내
                        </h2>
                    </div>
                    <div class="txt_noti_box mgB12">
                        <ul>
                            <li>㈜이지스엔터프라이즈에서는 기업/단체 및 개인의 정보 수집 및 이용등 처리에 있어 아래의 사항을 관련법령에 따라 고지하고 안내해드립니다.</li>
                            <li>
                                <b>개인정보 수집, 이용목적</b>
                                <span>1. 개인정보의 수집 이용목적 : 시스템이용문의, 견적문의, 제휴문의, 광고 및 진행</span>
                                <span>2. 수집항목 : 이름, 연락처, 이메일, 단지명(건물명)주소, 세대수, 내용, 첨부파일</span>
                                <span>3. 보유기간 및 이용기간 : 이용목적 달성 및 일정기간 경과 후 파기. 정보제공자의 삭제 요청시 즉시 파기</span>
                                <span>4. 개인정보처리담당 : 전화 02-1566-4963</span>
                            </li>
                        </ul>
                    </div>
                    <div class="check_txt_btn mgRAuto mgB32">
                        <input type="checkbox" id="isPrivacyAgree" name="isPrivacyAgree" value="false">
                        <label for="isPrivacyAgree">
                            <span></span> 개인정보 수집 및 이용 목적에 동의 합니다.
                        </label>
                    </div>
                    <div class="button__box">
                        <a id="ok_btn" class="button button__Big button__darkNavy w160p h60p ">확인</a>
                    </div>
                </form>
            </div>
        </div>

    </div>
</div>
<!-- 컨텐츠 기본 영역 END-->
<script>

    $(document).ready(function () {
        $(".voice-request-tab").addClass("active");
        $(window).scroll(function () {
            $(".slideanim").each(function () {
                var pos = $(this).offset().top;

                var winTop = $(window).scrollTop();
                if (pos < winTop + 1000) {
                    $(this).addClass("slide");
                } else if (winTop == 0) {
                    $(this).removeClass("slide");
                }
                $(".main_txt").click(function () {

                });
            });

        });
        $("form").validate({
            rules:{
                aptName:{
                    required:true,
                    maxlength:[20]
                },
                email:{
                    required: false,
                    maxlength: [30],
                    email:true
                },
                householdNum:{
                    required: false,
                    maxlength: [5],
                },
                contact:{
                    required: true,
                    maxlength: [13],
                    phoneNumberValidation: true
                },
                isPrivacyAgree:{
                    required: true,
                }
            },
            messages:{
                aptName:{
                    required:"단지명은 필수입니다.",
                    maxlength:"단지명은 {0}자 까지 입력 가능합니다."
                },
                email:{
                    maxlength:"이메일은 {0}자 까지 입력 가능합니다.",
                    email:"이메일 형식을 확인해주세요"
                },
                householdNum: {
                    maxlength: "세대수는 {0}자 까지 입력 가능합니다.",
                },
                contact: {
                    required: "연락처는 필수입니다.",
                    maxlength: "연락처는 {0}자 까지 입력 가능합니다.",
                    phoneNumberValidation: "정확한 연락처를 입력해주세요."
                },
                isPrivacyAgree: {
                    required: "약관에 동의해주세요."
                }
            },
            errorPlacement: function (err, element) {
                element.before(err);
            },
        });
        $.validator.addMethod("phoneNumberValidation", function (value, element) {
            // 정규식을 사용하여 한국 휴대폰 번호 형식을 검사
            return this.optional(element) || /^(01[016789]{1}|02|0[3-9]{1}[0-9]{1})-?[0-9]{3,4}-?[0-9]{4}$/.test(value);
        }, "정확한 연락처를 입력해주세요.");

    });


</script>
<script th:inline="javascript">

    const actionForm = $("form"); //form 태그 객체

    $("#ok_btn").click(function () {
        const selectedOption = $("#dataForm option:selected").val().trim(); // 선택된 option 값 가져오기
        let inputValue = $("#householdNum").val();
        // 입력값에서 콤마(,)를 제거하여 저장합니다.
        let numericValue = parseInt(inputValue.replace(/,/g, ''));
        
        let formData = actionForm.serializeArray().reduce(function (obj, item) {
            if (item.name === "requestStatus") { // 필드명이 requestStatus 일 경우
                obj[item.name] = selectedOption.replace(/^\d+\.\s+/, "");
            } else if (item.name === "isPrivacyAgree") {
                obj[item.name] = $("#isPrivacyAgree").is(":checked");
            } else if (item.name === "householdNum") {
                obj[item.name] = parseInt(inputValue.replace(/,/g, ''));
            } else {
                obj[item.name] = item.value;
            }
            return obj;
        }, {});
        
        if(!actionForm.valid()){
            return;
        };

        let jsonData = JSON.stringify(formData);
        $.ajax({
            url: "/main/voice-request",
            type: "POST",
            dataType: "json",
            data: jsonData,
            contentType: "application/json; charset=UTF-8",
            success: function (result) {
                alert("상담신청이 완료되었습니다.");
                actionForm[0].reset();
            },
            error: function (e) {
                alert("상담신청이 실패 되었습니다. 관리자에게 문의하세요.");
                console.error(e);
            }
        });
    });


</script>
</body>
</html>
